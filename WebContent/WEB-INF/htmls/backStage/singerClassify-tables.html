
<div class="row">
	<div class="col-lg-12">
		<h1 class="page-header">全部歌手分类</h1>
	</div>
	<!-- /.col-lg-12 -->
</div>
<!-- /.row -->
<div class="row">
	<div class="col-lg-12">
		<div class="panel panel-default">
			<!-- /.panel-heading -->
			<div class="panel-body">
				<div class="">
					<label>一级分类</label>
					<button id="" class="btn btn-default pull-right" data-toggle="modal" data-target="#first-add" style="margin-bottom: 10px;">添加</button>
				</div>
				<div class="">
					<table width="100%" class="table table-striped table-bordered table-hover" id="dataTables-example">
						<thead>
							<tr>
								<th>分类id</th>
								<th>分类名</th>
								<th>操作</th>
							</tr>
						</thead>
						<tbody id="firstClassifyTbody">
							<tr class="prototype">
								<td class="firstClassifyId"></td>
								<td class="firstClassifyName"></td>
								<td class="center" style="text-align: center;">
									<button class="btn btn-info" data-type="edit" data-toggle="modal" data-target="#first-edit">
										<span class="glyphicon glyphicon-edit" data-type="edit"></span>
									</button>
									<button class="btn btn-danger" data-type="delete">
										<span class="glyphicon glyphicon-trash" data-type="delete"></span>
									</button>
								</td>
							</tr>
						</tbody>
					</table>
					<div class="modal fade" id="first-add" tabindex="-1" role="dialog" aria-hidden="true">
						<div class="modal-dialog">
							<div class="modal-content">
								<div class="modal-header">
									<button class="close" type="button" data-dismiss="modal">&times;</button>
									<h4 class="modal-title">添加一级分类</h4>
								</div>
								<div class="modal-body">
									<form id="firstAddForm">
										<div class="form-group">
											<label>分类名</label> 
											<input name="name" type="text" class="form-control" />
											<p class="help-block">必填，不能包含特殊字符</p>
										</div>
									</form>
								</div>
								<div class="modal-footer">
									<button type="button" class="btn btn-default" data-dismiss="modal">关闭</button>
									<button id="addFirstClassify" type="button" class="btn btn-primary">提交</button>
								</div>
							</div>
						</div>
					</div>
					<div class="modal fade" id="first-edit" tabindex="-1" role="dialog" aria-hidden="true">
						<div class="modal-dialog">
							<div class="modal-content">
								<div class="modal-header">
									<button class="close" type="button" data-dismiss="modal">&times;</button>
									<h4 class="modal-title">修改一级分类</h4>
								</div>
								<div class="modal-body">
									<form id="firstEditForm">
										<div class="form-group">
											<label>分类名</label>
											<input name="id" type="hidden"> 
											<input name="name" type="text" class="form-control" />
											<p class="help-block">必填，不能包含特殊字符</p>
										</div>
									</form>
								</div>
								<div class="modal-footer">
									<button type="button" class="btn btn-default" data-dismiss="modal">关闭</button>
									<button type="button" id="editFirstClassify" class="btn btn-primary">修改</button>
								</div>
							</div>
						</div>
					</div>
				</div>
				<div class="">
					<label>二级分类</label>
					<button class="btn btn-default pull-right" data-toggle="modal" data-target="#second-add" style="margin-bottom: 10px;">添加</button>
				</div>
				<div class="">
					<table width="100%" class="table table-striped table-bordered table-hover" id="dataTables-example">
						<thead>
							<tr>
								<th>分类id</th>
								<th>分类名</th>
								<th>所属一级分类id</th>
								<th>操作</th>
							</tr>
						</thead>
						<tbody id="secondClassifyTbody">
							<tr class="prototype">
								<td class="secondClassifyId"></td>
								<td class="secondClassifyName"></td>
								<td class="firstClassifyId"></td>
								<td class="center" style="text-align: center;">
									<button class="btn btn-info" data-type="edit" data-toggle="modal" data-target="#second-edit">
										<span class="glyphicon glyphicon-edit" data-type="edit"></span>
									</button>
									<button class="btn btn-danger" data-type="delete">
										<span class="glyphicon glyphicon-trash" data-type="delete"></span>
									</button>
								</td>
							</tr>
						</tbody>
					</table>
					<div class="modal fade" id="second-add" tabindex="-1" role="dialog" aria-hidden="true">
						<div class="modal-dialog">
							<div class="modal-content">
								<div class="modal-header">
									<button class="close" type="button" data-dismiss="modal">&times;</button>
									<h4 class="modal-title">添加二级分类</h4>
								</div>
								<div class="modal-body">
									<form id="secondAddForm">
										<div class="form-group">
											<label>分类名</label> 
											<input name="name" type="text" class="form-control" />
											<p class="help-block">必填，不能包含特殊字符</p>
										</div>
										<div class="form-group">
											<label>所属一级分类</label> 
											<select name="firstClassifyId" class="form-control selectFirstClassify">
											</select>
											<p class="help-block">必填</p>
										</div>
									</form>
								</div>
								<div class="modal-footer">
									<button type="button" class="btn btn-default" data-dismiss="modal">关闭</button>
									<button type="button" class="btn btn-primary" id="addSecondClassify">提交</button>
								</div>
							</div>
						</div>
					</div>
					<div class="modal fade" id="second-edit" tabindex="-1" role="dialog" aria-hidden="true">
						<div class="modal-dialog">
							<div class="modal-content">
								<div class="modal-header">
									<button class="close" type="button" data-dismiss="modal">&times;</button>
									<h4 class="modal-title">修改二级分类</h4>
								</div>
								<div class="modal-body">
									<form id="secondEditForm">
										<div class="form-group">
											<label>分类名</label> 
											<input name="id" type="hidden"> 
											<input name="name" type="text" class="form-control" />
											<p class="help-block">必填，不能包含特殊字符</p>
										</div>
										<div class="form-group">
											<label>所属一级分类</label> 
											<select name="firstClassifyId" class="form-control selectFirstClassify">
											</select>
											<p class="help-block">必填</p>
										</div>
									</form>
								</div>
								<div class="modal-footer">
									<button type="button" class="btn btn-default" data-dismiss="modal">关闭</button>
									<button type="button" class="btn btn-primary" id="editSecondClassify">修改</button>
								</div>
							</div>
						</div>
					</div>
				</div>
			</div>
			<!-- /.panel-body -->
		</div>
		<!-- /.panel -->
	</div>
	<!-- /.col-lg-12 -->
</div>
<script type="text/javascript">

	(function(){
		var $firstTbody = $("#firstClassifyTbody") //
		, $secondTbody = $("#secondClassifyTbody") //
		, $firstPrototype = $firstTbody.find(".prototype").clone().removeClass("prototype") //
		, $secondPrototype = $secondTbody.find(".prototype").clone().removeClass("prototype") //
		, $firstAddForm = $("#firstAddForm") //
		, $addFirstClassify = $("#addFirstClassify") //
		, $firstEditForm = $("#firstEditForm") //
		, $editFirstClassify = $("#editFirstClassify") //
		, $secondAddForm = $("#secondAddForm") //
		, $addSecondClassify = $("#addSecondClassify") //
		, $secondEditForm = $("#secondEditForm") //
		, $editSecondClassify = $("#editSecondClassify") //
		, $selects = $(".selectFirstClassify")
		;
		
		$.ajax({
			url:"/music/admin/firstClassify",
			type:"GET",
			dataType:"json"
		}).done(function(data){
			if(data.code != 200){
				alert("加载失败");
				return;
			}
			
			var firstClassifys = data.data //
			, $firstClassify //
			;
			
			firstClassifys.forEach(function(firstClassify,index){
				$firstClassify = $firstPrototype.clone();
				
				$firstClassify.attr("data-url","/music/admin/firstClassify/"+firstClassify.id) //
				.addClass(index % 2 == 0 ? "odd" : "even");

				$firstClassify.find(".firstClassifyId").text(firstClassify.id);
				$firstClassify.find(".firstClassifyName").text(firstClassify.name);
				
				$firstTbody.append($firstClassify);
				
				$selects.append("<option value='"+firstClassify.id+"'>"+firstClassify.name+"</option>")
			});
			
			$firstTbody.on("click",function(e){
				var type = $(e.target).attr("data-type") //
				, $firstClassify = $(e.target).parents("tr");
				switch(type){
					case "delete" :
						deleteItem($firstClassify);
						break;
					case "edit" :
						var id = $firstClassify.find(".firstClassifyId").text() //
						, name = $firstClassify.find(".firstClassifyName").text();
						$firstEditForm.find("input[name='id']").val(id);
						$firstEditForm.find("input[name='name']").val(name);
						break;
					default : 
						return;
				}
			});
		});
		
		$.ajax({
			url:"/music/admin/secondClassify",
			type:"GET",
			dataType:"json"
		}).done(function(data){
			if(data.code != 200){
				alert("加载失败");
				return;
			}
			
			var secondClassifys = data.data //
			, $secondClassify //
			;
			
			secondClassifys.forEach(function(secondClassify,index){
				$secondClassify = $secondPrototype.clone();
				
				$secondClassify.attr("data-url","/music/admin/secondClassify/"+secondClassify.id) //
				.addClass(index % 2 == 0 ? "odd" : "even");

				$secondClassify.find(".secondClassifyId").text(secondClassify.id);
				$secondClassify.find(".secondClassifyName").text(secondClassify.name);
				$secondClassify.find(".firstClassifyId").text(secondClassify.firstClassifyId);
				
				$secondTbody.append($secondClassify);
			});
			
			$secondTbody.on("click",function(e){
				var type = $(e.target).attr("data-type") //
				, $secondClassify = $(e.target).parents("tr");
				switch(type){
					case "delete" :
						deleteItem($secondClassify);
						break;
					case "edit" :
						var id = $secondClassify.find(".secondClassifyId").text() //
						, name = $secondClassify.find(".secondClassifyName").text() //
						, firstClassifyId = $secondClassify.find(".firstClassifyId").text();
						$secondEditForm.find("input[name='id']").val(id);
						$secondEditForm.find("input[name='name']").val(name);
						$secondEditForm.find("select[name='firstClassifyId']").val(firstClassifyId);
						break;
					default : 
						return;
				}
			});
		});

		$addFirstClassify.on("click",function(){
			var name = $firstAddForm.find("input[name='name']").val();
			
			if(!name || name.trim() == ""){
				return alert("分类名不能为空");
			}
			
			$.ajax({
				url:"/music/admin/firstClassify",
				type:"POST",
				dataType:"JSON",
				data:{name:name}
			}).done(function(data){
				if(data.code == 200){
					alert("操作成功");
					refresh("/music/admin/html/singerClassify-tables");
				}else{
					alert("操作失败");
				}
			});
		});
		$editFirstClassify.on("click",function(){
			var id = $firstEditForm.find("input[name='id']").val() //
			, name = $firstEditForm.find("input[name='name']").val();
			
			if(!id){
				return alert("未知错误");
			}
			if(!name || name.trim() == ""){
				return alert("分类名不能为空");
			}
			
			$.ajax({
				url:"/music/admin/firstClassify/"+id,
				type:"PUT",
				dataType:"JSON",
				data:{name:name}
			}).done(function(data){
				if(data.code == 200){
					alert("操作成功");
					refresh("/music/admin/html/singerClassify-tables");
				}else{
					alert("操作失败");
				}
			});
		});
		
		$addSecondClassify.on("click",function(){
			var name = $secondAddForm.find("input[name='name']").val() //
			, firstClassifyId = $secondAddForm.find("select[name='firstClassifyId']").val();
			
			if(!name || name.trim() == ""){
				return alert("分类名不能为空");
			}
			if(!firstClassifyId || firstClassifyId.trim() == ""){
				return alert("一级分类不能为空");
			}
			
			$.ajax({
				url:"/music/admin/secondClassify",
				type:"POST",
				dataType:"JSON",
				data:{name:name,firstClassifyId:firstClassifyId}
			}).done(function(data){
				if(data.code == 200){
					alert("操作成功");
					refresh("/music/admin/html/singerClassify-tables");
				}else{
					alert("操作失败");
				}
			});
		});
		$editSecondClassify.on("click",function(){
			var id = $secondEditForm.find("input[name='id']").val() //
			, name = $secondEditForm.find("input[name='name']").val() //
			, firstClassifyId = $secondEditForm.find("select[name='firstClassifyId']").val();
			
			if(!id){
				return alert("未知错误");
			}
			if(!name || name.trim() == ""){
				return alert("分类名不能为空");
			}
			if(!firstClassifyId || firstClassifyId.trim() == ""){
				return alert("一级分类不能为空");
			}
			
			$.ajax({
				url:"/music/admin/secondClassify/"+id,
				type:"PUT",
				dataType:"JSON",
				data:{name:name,firstClassifyId:firstClassifyId}
			}).done(function(data){
				if(data.code == 200){
					alert("操作成功");
					refresh("/music/admin/html/singerClassify-tables");
				}else{
					alert("操作失败");
				}
			});
		});
	}())

</script>